{% extends 'back/layout.html' %}

{% block css %}
    <style>
    .content-box {
        width: 800px;
        margin-left: 20px;
        margin-top: 20px;
    }
    .user_left {
        float: left;
        width: 500px;
    }
    .avatar {
        position: relative;
        width: 80px;
        height: 80px;
        margin-right: 180px;
        float: right;
    }
    .f1{
        position: absolute;
        height:80px;
        width: 80px;
        opacity: 0;
        z-index:10 ;
        }
    #previewImg {
        position: absolute;
    }
    .username {

        line-height: 34px;
    }

    </style>
{% endblock %}

{% block xx %}

<div class="content-box">
<form class="form-horizontal" novalidate method="POST" action="userinfo.html" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="user_left">
        <div class="form-group">
        <label class="col-sm-2 control-label">用户名</label>
        <div class="col-sm-10 username">
             {{ user_obj.username }}
        </div>
      </div>

          <div class="form-group">
        <label class="col-sm-2 control-label">昵称</label>
        <div class="col-sm-10">
          {{ obj.nickname }} {{ obj.errors.nickname.0 }}
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">邮箱</label>
        <div class="col-sm-10">
          {{ obj.email }} {{ obj.errors.email.0 }}
        </div>
      </div>
        <div class="form-group">
        <label class="col-sm-2 control-label">博客地址</label>
        <div class="col-sm-10">
          {{ obj.site }} {{ obj.errors.site.0 }}
        </div>
      </div>
        <div class="form-group">
        <label class="col-sm-2 control-label">博客主题</label>
        <div class="col-sm-10">
          {{ obj.theme }} {{ obj.errors.theme.0 }}
        </div>
      </div>
        <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-default">保存</button>
        </div>
      </div>
    </div>

    <div class="avatar">
        {% if obj.avatar %}
            <img id="previewImg" style="height:80px; width: 80px;" src={{ user_obj.avatar }}>
        {% else %}
            <img id="previewImg" style="height:80px; width: 80px;" src="/static/images/default.png">
        {% endif %}
        {{ obj.avatar }}
    </div>

</form>
</div>

{% endblock %}


{% block js %}
<script src="/static/jquery-1.12.4.js"></script>
<script src="/static/jquery.cookie.js"></script>
<script>
        $(function () {
            bindAvatar();
        });

        function bindAvatar() {
            if (window.URL.createObjectURL){
                bindAvatar2();
            }else if(window.FileReader){
                bindAvatar3();
            }else{
                bindAvatar1()
            }
        }

        /*ajax 上传*/
        function bindAvatar1() {
            $('#imgSelect').change(function () {
                var formData = new FormData();
                formData.append('avatar',$(this)[0].files[0]);
                var token = $.cookie('csrftoken');

                $.ajax({
                    url:'/register/',
                    type:'POST',
                    headers:{'X-CSRFToken':token},
                    data:formData,
                    contentType:false,
                    processData:false,
                    success:function (arg) {
                        console.log(arg)
                    }
                })
            })
        }

        /*本地上传预览1*/
        function bindAvatar2() {
            $('#imgSelect').change(function () {
                /* 相同, 不需要两次转换
                console.log(this);
                console.log($(this)[0]);*/
                var obj = $(this)[0].files[0];
                var v = window.URL.createObjectURL(obj);
                $('#previewImg').attr('src',v);
                $('#previewImg').load(function () {
                    window.URL.revokeObjectURL(v);
                })
            })
        }

        /*本地上传预览2*/
        function bindAvatar3() {
            $('#imgSelect').change(function () {
                var obj = this.files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#previewImg').attr('src',this.result);
                };
                reader.readAsDataURL(obj);
            })
        }
    function changeCode(ths) {
        ths.src = ths.src + "?";
    }
</script>
{% endblock %}